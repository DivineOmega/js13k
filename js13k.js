function Convergame(t){function e(){return"getGamepads"in navigator}function n(){var t=navigator.getGamepads()[0],e="";e+="id: "+t.id+"<br/>";for(var n=0;n<t.buttons.length;n++)e+="Button "+(n+1)+": ",t.buttons[n].pressed&&(e+=" pressed"),e+="<br/>";for(var n=0;n<t.axes.length;n+=2)e+="Stick "+(Math.ceil(n/2)+1)+": "+t.axes[n]+","+t.axes[n+1]+"<br/>";$("#gamepadDisplay").html(e)}this.canvas=t,this.ctx=this.canvas.getContext("2d");var i,s,o,a=!1;this.scene=null,this.controlsMap={},this.then=null,this.sanityCheck=function(){return"object"!=typeof this.scene?(console.log("You must set a scene using the convergame.changeScene method."),!1):!0},this.mainGameLoop=function(){var t=Date.now(),e=t-this.then,n=e/1e3;this.scene.updateFunction(n),this.scene.renderFunction(),this.then=t,this.controlsPressed=[],requestAnimationFrame(this.mainGameLoop.bind(this))},this.startMainGameLoop=function(){this.sanityCheck()&&(this.then=Date.now(),this.mainGameLoop())},this.getCanvasWidth=function(){return t.width},this.getCanvasHeight=function(){return t.height},this.setCanvasWidth=function(){t.width=t.parentNode.offsetWidth},this.setCanvasHeight=function(){t.height=t.parentNode.offsetHeight},this.getControlNameFromKeyCode=function(t){var e=null;switch(t){case 37:e="left";break;case 38:e="up";break;case 39:e="right";break;case 40:e="down"}return e},this.isControlPressed=function(t){return"undefined"==typeof this.controlsMap[t]?!1:this.controlsMap[t]},this.init=function(){this.setCanvasWidth(),this.setCanvasHeight(),document.getElementById("body").style.padding="0",document.getElementById("body").style.margin="0",window.addEventListener("resize",function(t){this.setCanvasWidth(),this.setCanvasHeight()}.bind(this)),window.addEventListener("keydown",function(t){var e=this.getControlNameFromKeyCode(t.keyCode);this.controlsMap[e]=!0,[32,37,38,39,40].indexOf(t.keyCode)>-1&&t.preventDefault()}.bind(this)),window.addEventListener("keyup",function(t){var e=this.getControlNameFromKeyCode(t.keyCode);this.controlsMap[e]=!1}.bind(this)),this.canvas.ondragstart=function(t){return t&&t.preventDefault?t.preventDefault():t&&t.stopPropagation&&t.stopPropagation(),!1},this.canvas.onselectstart=function(t){return t&&t.preventDefault?t.preventDefault():t&&t.stopPropagation&&t.stopPropagation(),!1}},this.fullscreen=function(){t.requestFullScreen?t.requestFullScreen():t.webkitRequestFullScreen?t.webkitRequestFullScreen():t.mozRequestFullScreen?t.mozRequestFullScreen():alert("Error: Fullscreen mode not supported by your browser. Please upgrade and try again!")},this.resize=function(){t.setAttribute("width",parseInt(t.parentNode.offsetWidth,10)),t.setAttribute("height",parseInt(t.parentNode.offsetHeight,10))},this.doEvent=function(t,e,n){t.addEventListener(""+e,n)},this.setPixelGame=function(t){t?(this.ctx.webkitImageSmoothingEnabled=!1,this.ctx.mozImageSmoothingEnabled=!1,this.ctx.imageSmoothingEnabled=!1):(this.ctx.webkitImageSmoothingEnabled=!0,this.ctx.mozImageSmoothingEnabled=!0,this.ctx.imageSmoothingEnabled=!0)},this.getScreenScale=function(){return i=Math.min(convergame.getCanvasWidth()/1920+convergame.getCanvasHeight()/1080)/2},this.random=function(t,e){return Math.floor(Math.random()*(1+e-t))+t},this.sleep=function(t){for(var e=(new Date).getTime(),n=0;1e7>n&&!((new Date).getTime()-e>t);n++);},this.isCollide=function(t,e){return t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y?!0:!1},this.fetchGamepad=function(){if(e()){var t="To begin using your gamepad, connect it and press any button!";console.log(t),window.addEventListener("gamepadconnected",function(t){a=!0,console.log("Gamepad connected!"),s=window.setInterval(n,100)}),window.addEventListener("gamepaddisconnected",function(t){console.log("Gamepad disconnected!"),window.clearInterval(s)});var i=window.setInterval(function(){if(console.log("checkGP"),navigator.getGamepads()[0]){if(!a){var t=document.createEvent("HTMLEvents");t.initEvent("gamepadconnected",!0,!1),el.dispatchEvent(t)}window.clearInterval(i)}},500)}},this.getControllerAxis=function(){return gp=navigator.getGamepads()[0],o=gp.axes[0]},this.changeScene=function(t){this.scene=t,this.scene.init(this)},this.include=function(t){var e=document.createElement("script");e.src=""+t,e.type="text/javascript",document.body.appendChild(e)},this.preShake=function(){ctx.save();var t=8*Math.random(),e=8*Math.random();ctx.translate(t,e)},this.postShake=function(){ctx.restore()},this.vkUp=function(){return gp=navigator.getGamepads()[0],"undefined"!=typeof gp?1==gp.buttons[12].pressed?!0:!1:void 0},this.vkDown=function(){return gp=navigator.getGamepads()[0],"undefined"!=typeof gp?(gp=navigator.getGamepads()[0],1==gp.buttons[13].pressed?!0:!1):void 0},this.vkLeft=function(){return gp=navigator.getGamepads()[0],"undefined"!=typeof gp?(gp=navigator.getGamepads()[0],1==gp.buttons[14].pressed?!0:!1):void 0},this.vkRight=function(){return gp=navigator.getGamepads()[0],"undefined"!=typeof gp?(gp=navigator.getGamepads()[0],1==gp.buttons[15].pressed?!0:!1):void 0},this.vkStart=function(){},this.vkBtn1=function(){return gp=navigator.getGamepads()[0],"undefined"!=typeof gp?(gp=navigator.getGamepads()[0],1==gp.buttons[0].pressed?!0:!1):void 0},this.vkBtn2=function(){},this.vkBtn3=function(){},this.vkBtn4=function(){},this.vkBtnL=function(){},this.vkBtnR=function(){}}function ArtStyleTest(){this.convergame=null,this.updateFunction=function(t){},this.renderFunction=function(){var t=this.convergame.getCanvasWidth(),e=this.convergame.getCanvasHeight();this.convergame.ctx.fillStyle="#FEFEFE",this.convergame.ctx.fillRect(0,0,t,e);var n="#000000";this.convergame.ctx.fillStyle=n,this.convergame.ctx.font="bold "+32*this.convergame.getScreenScale()+"px Helvetica",this.convergame.ctx.fillText("Don't Read The Manual",64,48),this.convergame.ctx.font="16px Helvetica",this.convergame.ctx.fillText("3",t/4,e/4),this.convergame.ctx.fillText("14",t/2,e/2),this.convergame.ctx.fillText("21",100,250),this.convergame.ctx.fillText("45",t-250,550),this.convergame.ctx.rect(32,64,t-64,e-128),this.convergame.ctx.stroke(),this.convergame.ctx.fillText("2x",t/2+64,e-80),this.convergame.ctx.fillText("1x",t/2+128,e-80),this.convergame.ctx.fillText("1x",t/2+192,e-80),this.convergame.ctx.fillText("5x",t/2+256,e-80),this.convergame.ctx.rect(t/2,e-128,t/2-32,64),this.convergame.ctx.stroke()},this.init=function(t){this.convergame=t}}function ControlsTest(){this.convergame=null,this.textToDisplay="",this.updateFunction=function(t){this.textToDisplay="",this.textToDisplay+="Up: "+this.convergame.isControlPressed("up"),this.textToDisplay+=", ",this.textToDisplay+="Down: "+this.convergame.isControlPressed("down"),this.textToDisplay+=", ",this.textToDisplay+="Left: "+this.convergame.isControlPressed("left"),this.textToDisplay+=", ",this.textToDisplay+="Right: "+this.convergame.isControlPressed("right")},this.renderFunction=function(){var t=this.convergame.getCanvasWidth(),e=this.convergame.getCanvasHeight();this.convergame.ctx.fillStyle="#000000",this.convergame.ctx.fillRect(0,0,t,e);var n="#FFFFFF";this.convergame.ctx.fillStyle=n,this.convergame.ctx.font=32*convergame.getScreenScale()+"px Sans Serif",this.convergame.ctx.fillText("Dynamic multi-press control system!",100,100),this.convergame.ctx.fillText(this.textToDisplay,100,200)},this.init=function(t){this.convergame=t,this.textWhiteCounter=0,this.sceneChangeCounter=0}}function IntroScene(){this.convergame=null,this.textWhite=!0,this.textWhiteCounter=0,this.sceneChangeCounter=0,this.updateFunction=function(t){this.textWhiteCounter+=t,this.sceneChangeCounter+=t,this.textWhiteCounter>=.5&&(this.textWhite=!this.textWhite,this.textWhiteCounter=0),this.sceneChangeCounter>=5&&this.convergame.changeScene(testScene)},this.renderFunction=function(){var t=this.convergame.getCanvasWidth(),e=this.convergame.getCanvasHeight();this.convergame.ctx.fillStyle="#000000",this.convergame.ctx.fillRect(0,0,t,e);var n="#FF0000";this.textWhite&&(n="#FFFFFF"),this.convergame.ctx.fillStyle=n,this.convergame.ctx.font="30px Sans Serif",this.convergame.ctx.fillText("Reversed Game for JS13K",.5*t-200,.5*e)},this.init=function(t){this.convergame=t,this.textWhiteCounter=0,this.sceneChangeCounter=0}}function TestScene(){this.convergame=null,this.textBlue=!0,this.textBlueCounter=0,this.sceneChangeCounter=0,this.updateFunction=function(t){this.textBlueCounter+=t,this.sceneChangeCounter+=t,this.textBlueCounter>.25&&(this.textBlue=!this.textBlue,this.textBlueCounter=0),this.sceneChangeCounter>2.5&&this.convergame.changeScene(introScene)},this.renderFunction=function(){var t=this.convergame.getCanvasWidth(),e=this.convergame.getCanvasHeight();this.convergame.ctx.fillStyle="#000000",this.convergame.ctx.fillRect(0,0,t,e);var n="#00FF00";this.textBlue&&(n="#0000FF"),this.convergame.ctx.fillStyle=n,this.convergame.ctx.font="30px Sans Serif",this.convergame.ctx.fillText("Hello! I'm the test scene!",.5*t-200,.5*e)},this.init=function(t){this.convergame=t,this.textBlueCounter=0,this.sceneChangeCounter=0}}var canvas=document.getElementById("game"),canvas=document.getElementById("game"),introScene=new IntroScene,testScene=new TestScene,artStyleTest=new ArtStyleTest,controlsTest=new ControlsTest,convergame=new Convergame(canvas);convergame.init(),convergame.changeScene(controlsTest),convergame.startMainGameLoop();